# 30 分钟验证测试配置
# 用于验证分币种 IC 改进效果

# 继承基础配置
base_config: "base.yaml"

# 运行环境
environment: "mainnet"

# 影子交易模式
shadow_mode:
  enabled: true
  duration_hours: 0.167  # 10 分钟（支持 T+5 窗口回填）
  start_time: null

  fill_simulation:
    method: "realistic"
    max_slippage_bps: 50.0
    partial_fill_enabled: true

  initial_nav: 100000

  orders:
    ioc:
      enabled: true
      default_size: 0.01
      price_adjustment_bps: 10.0

    limit:
      enabled: false  # Week 1 只用 IOC
      default_size: 0.01
      timeout_seconds: 5.0
      use_post_only: true

    routing:
      enable_fallback: false
      fallback_timeout_seconds: 5.0

# 信号配置
signals:
  aggregation:
    method: "weighted_average"
    min_confidence: 0.1

  thresholds:
    theta_1: 0.7
    theta_2: 0.4

  sources:
    obi:
      enabled: true
      weight: 0.4
      levels: 5
    microprice:
      enabled: true
      weight: 0.3
    impact:
      enabled: true
      weight: 0.3

# 分析配置
analytics:
  ic_calculation:
    window_hours: 0.5
    min_samples: 30
    update_interval_minutes: 2

  future_return:
    window_minutes: 10
    update_interval_seconds: 10

  pnl_attribution:
    update_interval_minutes: 2
    save_to_file: true
    output_dir: "data/tests/shadow/records"

  launch_criteria:
    ic_min: 0.03
    alpha_pct_min: 70.0
    cost_pct_max: 25.0
    uptime_pct_min: 99.0
    p99_latency_ms_max: 150.0
    win_rate_min: 60.0

# 实时监控
monitoring:
  live_monitor:
    enabled: true
    update_interval_seconds: 30

    alert_thresholds:
      latency_ms: 200
      fill_rate_pct: 80
      drawdown_pct: 3.0
      consecutive_losses: 5

  logging:
    level: "INFO"
    format: "json"
    file_rotation: "daily"
    output_dir: "logs"

    include_fields:
      - "timestamp"
      - "event"
      - "symbol"
      - "signal_value"
      - "confidence"
      - "execution_result"
      - "latency_ms"
      - "pnl"

# 数据配置
data:
  orderbook:
    levels: 10
    update_frequency: 100

  persistence:
    enabled: true
    save_interval_minutes: 5
    output_dir: "data/tests/shadow/records"
    formats:
      - "parquet"
      - "json"

# Hyperliquid 连接
hyperliquid:
  endpoint: "mainnet"

  websocket:
    reconnect_enabled: true
    reconnect_max_attempts: 10
    reconnect_delay_seconds: 5
    heartbeat_interval_seconds: 30

  subscriptions:
    symbols:
      - "BTC"
      - "ETH"
      - "SOL"
    channels:
      - "l2Book"
      - "trades"
      - "user"

# 风控配置
risk:
  hard_limits:
    max_single_loss_pct: 0.008
    max_daily_drawdown_pct: 0.05
    max_position_size_usd: 10000

  position:
    max_leverage: 5
    inventory_target: 0
    inventory_tolerance: 0.2

# 报告配置
reporting:
  realtime:
    enabled: true
    interval_minutes: 5
    include_charts: true

  final_report:
    enabled: true
    output_dir: "data/tests/shadow/reports"
    formats:
      - "html"
      - "json"
      - "markdown"

    sections:
      - "summary"
      - "signal_quality"
      - "execution_efficiency"
      - "risk_metrics"
      - "pnl_attribution"
      - "launch_readiness"
