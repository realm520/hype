# 高频交易策略评审方案 - 纯盈利导向

> **核心理念**：从"纯盈利"（非做市/不以供流动性为目的）角度重构执行逻辑，实现可量化的盈利门槛与最小可行落地

---

## ⚠️ 重大更新（2025-10-29）

**策略修正**：经过多窗口 IC 分析和费用结构验证，发现 **Week 1 IOC-only 策略数学上不可行**：

### 原计划的致命缺陷

**错误 1 - 成本假设**：
- ❌ 原假设：单边成本 7.5 bps
- ✅ 实际：往返成本 = 开仓 7.5 bps + 平仓 7.5 bps = **15 bps**

**错误 2 - 期望收益公式**：
- ❌ 原公式：`E[return] = IC × σ × 2`
- ✅ 正确公式：`E[return] = IC × σ × z-score(signal)`
- Top 20% 信号的 z-score = 0.84 std（不是 2.0！）

### 盈利性分析

基于 5 分钟窗口实测数据：
```
IC = 0.37（OBI 信号）
σ(returns) = 45 bps/5min
Top 20% 信号期望收益 = 0.37 × 45 × 0.84 = 14.0 bps
IOC-only 往返成本 = 15 bps

净收益 = 14.0 - 15 = -1.0 bps ❌ 亏损！
```

### 新方案：Week 1.5 Maker/Taker 混合策略

**核心改进**：通过 Maker 开仓降低成本 27%

```
Maker 开仓：3.5 bps（1.5 fee + 1.0 slip + 1.0 impact）
Taker 平仓：7.5 bps（4.5 fee + 2.0 slip + 1.0 impact）
往返成本：11 bps（vs IOC-only 15 bps）

Top 20% 信号净收益 = 14.0 - 11 = +3.0 bps ✅ 盈利！
```

**详细设计**：参见 `docs/hybrid_strategy_design.md`
**修订路线图**：参见 `docs/revised_roadmap.md`

---

## 结论（TL;DR）

* 方案的工程与风控框架是对的，但若目标是**赚钱而非赚回扣**，应把默认执行从"被动挂单（maker）"切换为"**确定性成交（IOC/贴盘口限价）**"，将 **rebate 视为锦上添花**而非核心来源。
* 盈利关键在于：**信号的前瞻性强度 × 成交确定性 × 单笔期望值（扣除 taker 费/冲击/滑点）**。
* 强烈建议先做"**IOC-only 压力测试**"：如果去掉全部 maker 仍能盈利，策略就是真正的 **alpha 策略**；否则是在用执行技巧掩盖信号不足。

---

## 一、盈利模型与门槛（把钱算清楚）

以永续合约常见费率做一个通用盈亏模型：

```
E[trade] = p·g - (1-p)·l - fee - slip - impact
```

**参数说明**：
* `p`：胜率（Win Rate）
* `g, l`：盈利/亏损的**无摩擦**平均幅度（bps）
* `fee`：taker 费（如 5 bps）
* `slip + impact`：成交滑点与冲击（2–10 bps，视品种与时段）

### IOC-only 盈亏平衡

对称止盈止损（`g = l`）情况下：

```
p* ≈ 1/2 + (fee + slip + impact) / (2g)
```

**实例计算**：
* 若 `g = 20 bps`、费用+滑点合计 `8 bps`
* 则 `p* ≈ 0.5 + 8/40 = 0.70`
* **结论**：需要 70% 胜率才能盈亏平衡

### 盈利三要素

要提高期望收益，必须：
1. **提高单笔边际（g）**：更大的盈利空间
2. **降低成交成本**：优化 fee/滑点/冲击
3. **提高胜率（p）**：更准确的信号

### 落地建议

在回测与实盘归因中，**单独统计**：
* **方向性收益（Alpha）**：纯信号带来的盈利
* **手续费（Fee）**：交易成本
* **滑点（Slippage）**：执行偏差
* **回扣（Rebate）**：maker 奖励
* **冲击（Impact）**：市场冲击成本

**健康标准**：
* 若"回扣 + Carry" > "方向性收益"的 30%，说明策略更接近做市而非盈利策略
* **需减少 maker 依赖**，回归信号驱动

---

## 二、执行逻辑重构：从"被动优先"到"确定性优先"

### 原方案的偏差

* EV 比较器把 **passive（被动挂单）** 设为常态，这是做市心智
* 盈利策略应优先**成交确定性**，而非手续费优化

### 修正准则：强信号就打、弱信号才蹭

#### 1. 高置信度（|Score| > θ₁）
* **默认执行**：**IOC / 贴盘口限价**
* **目标**：立刻抓住价格漂移，确保成交
* **理由**：信号强时，Alpha 远大于手续费差异

#### 2. 中置信度（θ₂ < |Score| ≤ θ₁，低波动/低空洞）
* **可用策略**：**浅被动**（距离 mid ≤ 1–2 tick）
* **超时机制**：设置超时或 mid 偏移阈值 → 自动切 IOC
* **理由**：在流动性好时，浅被动可降低成本且不影响成交

#### 3. 低置信度（|Score| ≤ θ₂）
* **策略**：**不交易**
* **禁止**：杜绝"靠回扣赌成交"的投机行为

### 实操提示

* **贴盘口限价（Aggressive Limit）** 优先级常足以立刻成交
* 比市价单更可控，可轻度熨平滑点
* 比被动挂单更确定，避免排队风险

---

## 三、简化执行：从队列精算到市场可交易性

### 放弃重度队列建模

* **不要**做重度排队建模（那是做市商的"成本最优化"问题）
* 高频盈利策略的核心是**信号强度**，不是排队优化

### 使用盘口可交易性（Tradeability）

**定义**：
```
Tradeability = BestDepth / EatRate_{100ms}
```

**含义**：
* `BestDepth`：最优价位的挂单深度
* `EatRate_{100ms}`：过去 100ms 的吃单速率
* 低于某阈值（如 < 200ms）→ **放弃挂被动，直接 IOC**

### 简化撤单逻辑

只需两条规则：
1. **mid 偏离 > X bps**：市场价格大幅变动 → 撤单并切 IOC
2. **盘口结构变更**：best depth 大幅减少/价阶跳变 → 撤单并切 IOC

**优势**：
* 避开"虚假流动性"
* 把研发精力集中到"信号与成交确定性"

---

## 四、信号优先：先证伪，再优化执行

### 信号前瞻性检验

对每个信号做 **t → t+Δ 的 mid 变动回归/分层 IC**：

**目标指标**：
* **IC（Spearman）≥ 0.03**：信号与未来收益相关性
* **分层收益（Top vs Bottom）> 成交成本**：信号分层能力

**稳健性要求**：
* **跨波动**：高波动/低波动都稳定
* **跨时段**：不同交易时段都有效

### 盘口信号的状态过滤

对易失效的盘口信号（OBI、microprice），加入**状态过滤**：

* **低延迟—高相关**：投入更高权重
* **高延迟—低相关**：仅做风控约束，不作为入场主因

### 核心原则

> **没有 alpha 的执行优化，只是在精致地赔钱**

---

## 五、风控：从"停机"到"动态降频/换模式"

### 硬熔断（停机）仅保留

* **单笔亏损 > 0.8% 净值**
* **日回撤 > 5%**
* **API 异常/预言机异常**

### 其余改为模式切换

#### 1. 高波动环境
* **调整**：放大止损/止盈、缩短持有时长
* **理由**：避免被噪声止损

#### 2. 低流动性环境
* **调整**：只用 IOC、减小下单尺寸
* **理由**：避免冲击成本过高

#### 3. Funding 极端
* **调整**：禁逆势 carry，但允许顺势跟随
* **理由**：避免被资金费率侵蚀

---

## 六、验证路径（从"能赚"出发）

### A/B 实验设计

#### 实验 1：IOC-only 基线
* **设置**：全品种只用 IOC/贴盘口限价执行
* **目标**：拿到 **真实 Alpha 基线**
* **验证**：去除 maker 后是否仍能盈利

#### 实验 2：+浅被动增强
* **设置**：在基线之上，仅当 Tradeability 良好且 |Score| 中等时，叠加浅被动
* **目标**：比较 **净收益/成本下降**是否显著
* **验证**：浅被动是否真正降低成本而不影响成交

#### 实验 3：去平台/去时段稳健性
* **设置**：BTC/ETH vs 小币；高波动日 vs 平静日
* **目标**：验证策略的泛化能力
* **验证**：不同市场环境下是否稳定盈利

### 必看曲线与表

1. **Alpha vs 成交成本**的"刀叉图"（per regime）
2. **信号强度分桶**的胜率/期望值
3. **延迟 → Alpha 衰减**曲线（发现最佳 Δt 窗口）
4. **PnL 归因**：
   * Alpha ≥ 70%
   * Fee + Slip ≤ 25%
   * Rebate ≤ 10%（盈利导向的健康结构）

---

## 七、资金管理与规模化

### 头寸公式

```
Size = min(α · Score · (c/σ), MaxPos)
```

**参数说明**：
* `α`：资金利用系数
* `Score`：信号强度
* `c`：资金总量
* `σ`：波动率
* `MaxPos`：最大持仓限制

### 增加库存偏置（Inventory Bias）

* 抑制单边暴露，避免方向性风险累积

### 成交成本弹性

随着下单尺寸增长：
* **冲击/滑点非线性上升**
* 以"**边际 E[trade] 归零**"作为增量上限
* 防止规模化把 alpha 挤没

---

## 八、三周落地计划（Week 1.5 混合策略）

### Week 1.5 - Phase 1（Day 1-3）：Maker/Taker 混合执行器开发

#### 1. Shallow Maker 执行器
* **任务**：实现浅被动限价单逻辑（best bid/ask ± 1 tick）
* **超时机制**：5 秒未成交自动切换 IOC
* **输出**：Maker 成交率、成本分解

#### 2. 信号强度分类器
* **任务**：基于多窗口 IC 设定阈值（θ₁=0.45, θ₂=0.25）
* **输出**：High/Medium/Low 置信度分级

#### 3. 混合执行路由
* **任务**：
  - High 置信度：Maker 开仓 + IOC 平仓
  - Medium 置信度：Maker 开仓（5s 超时）+ IOC 平仓
  - Low 置信度：跳过交易
* **输出**：动态执行决策引擎

### Week 1.5 - Phase 2（Day 4-10）：纸交易验证

#### 4. 纸交易部署
* **任务**：WebSocket 实时数据 + 模拟执行（不实际下单）
* **监控**：
  - Maker 成交率（目标 ≥ 80%）
  - 实际成本分解（目标 ≤ 12 bps）
  - Top 20% 信号净利润（目标 ≥ +2 bps）

#### 5. 决策点 1（Day 10）
* **评估指标**：
  - Maker 成交率是否 ≥ 80%？
  - 成本是否 ≤ 12 bps？
  - Top 20% 是否盈利 ≥ +2 bps？
* **决策**：
  - ✅ 全部达标 → 进入 Phase 3 小资金实盘
  - ⚠️ 部分达标 → 调整参数后继续纸交易 3 天
  - ❌ 严重不达标 → 回到 Phase 1 重新设计

### Week 1.5 - Phase 3（Day 11-21）：小资金实盘验证

#### 6. 实盘部署（小资金）
* **资金规模**：≤ 5% 总资金
* **监控**：
  - 7 日 Sharpe 比率（目标 > 1.5）
  - 最大回撤（目标 < 8%）
  - 实盘 vs 纸交易偏差（目标 < 30%）

#### 7. PnL 归因分析
* **任务**：Alpha/Cost/Rebate 分解
* **验证**：
  - Alpha 占比 ≥ 70%
  - Fee + Slip ≤ 25%
  - Rebate ≤ 10%

#### 8. 决策点 2（Day 21）
* **评估指标**：
  - Sharpe > 1.5？
  - Max Drawdown < 8%？
  - 实盘偏差 < 30%？
* **决策**：
  - ✅ 全部达标 → Week 1.5 成功，进入 Week 2 深度被动
  - ⚠️ 部分达标 → 继续小资金运行 7 天后重评估
  - ❌ 严重不达标 → 策略失败，回到设计阶段

---

## 九、关键验证问题（团队自检清单）

### 1. Alpha 真实性（已验证 ❌）
**问**：去掉全部 maker，只用 IOC，是否仍能盈利？
* **验证结果**：❌ **No** - Week 1 IOC-only 数学上不可行
* **原因**：往返成本 15 bps > 预期收益 14 bps（Top 20% 信号）
* **修正方案**：Week 1.5 混合策略降低成本至 11 bps，实现盈利

### 2. 信号质量（已验证 ✅）
**问**：IC > 0.03 的信号有几个？跨时段/品种还能站得住吗？
* **验证结果**：✅ **Yes** - OBI 和 Microprice 信号质量优秀
* **实测 IC（BTC 1 小时数据）**：
  - 1m: IC = 0.55（OBI），0.55（Microprice）
  - 5m: IC = 0.37（OBI），0.37（Microprice）
  - 10m: IC = 0.19（OBI），0.20（Microprice）
* **稳健性**：BTC 和 ETH 均显示一致的信号衰减模式
* **结论**：信号质量足够支撑策略，关键在执行成本优化

### 3. PnL 结构健康度
**问**：Alpha 占 PnL 比例 ≥ 70% 吗？
* **Yes** → 盈利策略
* **No** → 做市策略（不符合目标）

### 4. 延迟敏感性
**问**：延迟每增加 50ms，单笔期望值下降多少？
* 决定是否值得继续压榨工程延迟

### 5. 规模上限
**问**：放大下单尺寸后，边际 E[trade] 何时归零？
* 决定策略的资金容量

---

## 十、一句话总结

> ~~**把默认执行改成"信号强时立刻成交、信号弱时不勉强"；让 maker 只在中性/低波动当作成本优化选项。先跑出 IOC-only 的真 Alpha，再谈任何挂单与排队的花活。**~~

**更新（2025-10-29）**：

> **验证发现 IOC-only 数学上不可行（成本 15 bps > 收益 14 bps）。修正方案：Week 1.5 Maker/Taker 混合策略，通过浅被动 Maker 开仓降低成本至 11 bps，使 Top 20% 信号实现 +3 bps 净利润。核心是"信号强度驱动的动态执行"，而非纯 Taker 或纯 Maker。**

---

## 附录：术语表

| 术语 | 解释 |
|------|------|
| **IOC** | Immediate-Or-Cancel，立即成交或取消 |
| **Maker** | 被动挂单方，提供流动性，享受 rebate |
| **Taker** | 主动吃单方，消耗流动性，支付 fee |
| **Alpha** | 信号带来的超额收益（扣除市场基准） |
| **IC** | Information Coefficient，信号与收益的相关性 |
| **Slippage** | 滑点，预期价格与成交价格的差异 |
| **Impact** | 冲击，大单对市场价格的影响 |
| **Tradeability** | 可交易性，盘口深度与吃单速率的比值 |
| **OBI** | Order Book Imbalance，订单簿不平衡度 |
| **Microprice** | 微观价格，基于订单簿加权的理论价格 |

---

**文档版本**：v1.0
**最后更新**：2025-10-25
**适用项目**：Hyperliquid 高频交易系统
